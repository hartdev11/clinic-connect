# E3.3–E3.4 — KnowledgeDocument Schema

## Fields

| Field | Type | Required | หมายเหตุ |
|-------|------|----------|----------|
| id | string | ✅ | รหัสเอกสาร |
| level | string | ✅ | global \| org \| branch \| conversation |
| org_id | string | ❌ | องค์กร (level=org/branch ใช้) |
| branch_id | string | ❌ | สาขา (level=branch ใช้) |
| topic | string | ✅ | หัวข้อ |
| category | string | ✅ | หมวดหมู่ (service, price, faq, promotion ฯลฯ) |
| key_points | string[] | ✅ | จุดสำคัญ |
| text | string | ✅ | ข้อความที่ embed |
| expires_at | string (ISO) | ❌ | หมดอายุเมื่อไหร่ |
| is_active | boolean | ✅ | เปิดใช้งานหรือไม่ |
| archived_at | string (ISO) | ❌ | เก็บเมื่อไหร่ |
| source | string | ✅ | แหล่งที่มา (manual, import, conversation) |
| createdAt | string (ISO) | ✅ | |
| updatedAt | string (ISO) | ✅ | |

---

## level semantics

| level | org_id | branch_id | Scope |
|-------|--------|-----------|-------|
| global | — | — | ทุก org |
| org | ✅ | — | เฉพาะ org |
| branch | ✅ | ✅ | เฉพาะสาขา |
| conversation | — | — | ใช้ใน conversation context |

---

## Pinecone metadata

key_points เก็บเป็น string (JSON.stringify) ใน metadata เพราะ Pinecone metadata รองรับ primitives

```typescript
{
  level: "org",
  org_id: "org_xyz",
  topic: "filler",
  category: "service",
  key_points: "[\"ราคา 8,000–20,000\",\"เหมาะกับปรับรูปหน้า\"]",
  is_active: true,
  source: "manual"
}
```
