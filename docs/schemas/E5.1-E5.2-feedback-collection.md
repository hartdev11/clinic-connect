# E5.1–E5.2 — Feedback Collection (Golden Dataset)

## สรุป

- `conversation_feedback` — Firestore collection
- Admin mark success / fail ผ่าน UI

## Schema (conversation_feedback)

| Field        | Type   | หมายเหตุ                          |
|-------------|--------|-----------------------------------|
| org_id      | string | ต้องตั้ง LINE_ORG_ID ใน webhook   |
| branch_id   | string?|                                   |
| user_id     | string?| LINE userId                       |
| userMessage | string |                                   |
| botReply    | string |                                   |
| intent      | string?|                                   |
| service     | string?|                                   |
| area        | string?|                                   |
| source      | string | "line" \| "web"                   |
| adminLabel  | "success" \| "fail" \| null | รอป้าย = null |
| adminLabeledAt | timestamp? |                    |
| adminLabeledBy | string? | userId ของ admin ที่ป้าย        |
| createdAt   | timestamp |                                   |
| updatedAt   | timestamp |                                   |

## การใช้งาน

1. **บันทึก feedback** — LINE webhook บันทึกอัตโนมัติเมื่อมี reply (ต้องตั้ง `LINE_ORG_ID` ใน .env.local)
2. **Admin UI** — `/clinic/feedback` (Golden Dataset ใน sidebar)
3. **API**
   - GET `/api/clinic/feedback` — list feedback (org-scoped)
   - PATCH `/api/clinic/feedback/[id]` — mark success/fail (`body: { label: "success" | "fail" | null }`)

## หมายเหตุ

- ต้องตั้ง `LINE_ORG_ID` = org document id ที่ต้องการผูก LINE channel กับ org นั้น
- Firestore index: `conversation_feedback` (org_id ASC, createdAt DESC)
