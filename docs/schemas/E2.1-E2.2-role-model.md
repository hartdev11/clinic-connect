# E2.1–E2.2 — Role Model (RBAC)

## Roles (org-level)
| Role | หมายเหตุ |
|------|----------|
| **owner** | เจ้าของ org — สิทธิ์เต็มทุกสาขา |
| **manager** | ผู้จัดการ — สิทธิ์ตาม branch_ids หรือทั้ง org |
| **staff** | พนักงาน — สิทธิ์เฉพาะ branch_ids ที่กำหนด |

---

## users collection schema

| Field | Type | Required | หมายเหตุ |
|-------|------|----------|----------|
| id | string | auto | Firestore doc ID |
| org_id | string | ✅ | FK → organizations.id |
| email | string | ✅ | อีเมล (unique per org) |
| role | string | ✅ | owner \| manager \| staff |
| branch_ids | string[] | ❌ | สาขาที่เข้าถึงได้; owner มักไม่ใช้ (ทั้ง org); staff/manager ใช้จำกัดสาขา |
| default_branch_id | string | ❌ | สาขา default สำหรับ session |
| createdAt | Timestamp | ✅ | |
| updatedAt | Timestamp | ✅ | |
| passwordHash | string | ✅ | (เก็บใน users) |

---

## branch_ids semantics
- **owner**: `branch_ids` มักเป็น null/omit = เข้าถึงทุกสาขา
- **manager**: `branch_ids` null = ทั้ง org; มีค่า = เฉพาะสาขาที่กำหนด
- **staff**: `branch_ids` = เฉพาะสาขาที่กำหนด (ต้องมีอย่างน้อย 1 สาขา)

---

## ตัวอย่าง Document

```json
{
  "org_id": "org_xyz789",
  "email": "staff@clinic.com",
  "role": "staff",
  "branch_ids": ["branch_def456"],
  "default_branch_id": "branch_def456",
  "passwordHash": "...",
  "createdAt": "2025-02-10T08:00:00.000Z",
  "updatedAt": "2025-02-10T08:00:00.000Z"
}
```
