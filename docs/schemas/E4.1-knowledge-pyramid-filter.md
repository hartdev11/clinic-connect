# E4.1 — Knowledge Pyramid Filter Logic

## Filter Logic (by context level)

| level       | Filters          | Scope                         |
|-------------|------------------|-------------------------------|
| global      | none             | ทุก org, ไม่ filter           |
| org         | org_id           | global + org docs             |
| branch      | org_id + branch_id | global + org + branch docs  |
| conversation| org_id (+ branch_id) | global + org + conversation |

## Implementation

- `buildKnowledgePyramidFilter(context)` — สร้าง Pinecone filter ($or) ตาม context
- `searchKnowledgeWithPyramid(query, context, options?)` — ค้นหาด้วย pyramid filter

## Usage

```typescript
import { searchKnowledgeWithPyramid, type KnowledgeSearchContext } from "@/lib/knowledge-vector";

// branch context
const ctx: KnowledgeSearchContext = {
  level: "branch",
  org_id: "org-1",
  branch_id: "branch-1",
};
const results = await searchKnowledgeWithPyramid("นัดหมาย", ctx, { topK: 5 });
```
