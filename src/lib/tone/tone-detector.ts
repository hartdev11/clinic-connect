import type { ToneLevel } from "../agents/conversation-state";

/**
 * Tone Detector
 * 
 * üîë ‡∏ï‡∏±‡∏ß‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡πà‡∏≤ AI ‡∏à‡∏∞‡∏û‡∏π‡∏î "‡∏™‡∏±‡πâ‡∏ô / ‡∏Å‡∏•‡∏≤‡∏á / ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢" ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏ô‡∏à‡∏£‡∏¥‡∏á
 * 
 * ‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î‡πÇ‡∏Ñ‡∏ï‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:
 * ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö service
 * ‡πÅ‡∏ï‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö ‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
 * 
 * ‡∏Å‡∏é‡πÄ‡∏´‡∏•‡πá‡∏Å:
 * - ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ LLM ‡πÄ‡∏î‡∏≤
 * - Deterministic ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô = ‡∏Ñ‡∏∏‡∏°‡πÑ‡∏î‡πâ 100%
 * - tone ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏≤‡∏° "‡∏£‡∏≠‡∏ö‡∏™‡∏ô‡∏ó‡∏ô‡∏≤" ‡πÑ‡∏°‡πà fixed
 * 
 * @param message ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
 * @returns ToneLevel ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
 */
export function detectTone(message: string): ToneLevel {
  const lower = message.toLowerCase().trim();

  // ‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏π‡πâ‡∏à‡∏£‡∏¥‡∏á ‚Üí explain
  // ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å
  if (
    /‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£|‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô|‡∏¢‡∏±‡∏á‡πÑ‡∏á|‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢|‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î|‡∏Ç‡πâ‡∏≠‡∏î‡∏µ|‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢|‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á|‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢|‡∏ó‡∏≥‡∏¢‡∏±‡∏á‡πÑ‡∏á|‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô|‡∏ß‡∏¥‡∏ò‡∏µ|‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ|‡∏ß‡∏±‡∏™‡∏î‡∏∏|‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤|‡∏û‡∏±‡∏Å‡∏ü‡∏∑‡πâ‡∏ô|‡∏ú‡∏•‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á|‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á/.test(lower)
  ) {
    return "explain";
  }

  // ‡∏™‡∏ô‡πÉ‡∏à‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏´‡∏ô‡∏∂‡πà‡∏á ‚Üí medium
  // ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏•‡∏∂‡∏Å‡∏°‡∏≤‡∏Å
  if (
    /‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥|‡πÄ‡∏´‡∏°‡∏≤‡∏∞|‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô‡∏î‡∏µ|‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥|‡πÇ‡∏≠‡πÄ‡∏Ñ‡πÑ‡∏´‡∏°|‡∏î‡∏µ‡πÑ‡∏´‡∏°|‡πÄ‡∏õ‡πá‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏á|‡∏î‡∏µ‡∏¢‡∏±‡∏á‡πÑ‡∏á|‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤|‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö|‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏á/.test(lower)
  ) {
    return "medium";
  }

  // ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏™‡∏±‡πâ‡∏ô / ‡∏ï‡∏≠‡∏ö‡∏™‡∏±‡πâ‡∏ô ‚Üí short
  // Default: ‡∏ï‡∏≠‡∏ö‡∏™‡∏±‡πâ‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏™‡∏°‡∏≠
  return "short";
}
