/**
 * ðŸ”§ Refinement Guard: à¹à¸à¹‰à¸›à¸±à¸à¸«à¸² "à¹‚à¸”à¹ˆà¸‡à¹† à¹à¸¥à¹‰à¸§à¸£à¸°à¸šà¸šà¸žà¸±à¸‡"
 * 
 * Refinement = à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸ªà¸±à¹‰à¸™ à¹† à¸•à¹ˆà¸­à¸ˆà¸²à¸à¸šà¸£à¸´à¸à¸²à¸£à¹€à¸”à¸´à¸¡ (à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆ intent à¹ƒà¸«à¸¡à¹ˆ)
 * à¹€à¸Šà¹ˆà¸™ "à¸­à¸¢à¸²à¸à¸—à¸³à¹à¸šà¸šà¹‚à¸”à¹ˆà¸‡à¹†", "à¹à¸šà¸šà¸˜à¸£à¸£à¸¡à¸Šà¸²à¸•à¸´", "à¸ªà¸²à¸¢à¹€à¸à¸²à¸«à¸¥à¸µ"
 * 
 * à¸à¸•à¸´à¸à¸²:
 * â— à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆ intent à¹ƒà¸«à¸¡à¹ˆ
 * â— à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆ service à¹ƒà¸«à¸¡à¹ˆ
 * â— à¹à¸•à¹ˆà¸„à¸·à¸­ REFINEMENT à¸‚à¸­à¸‡ service à¹€à¸”à¸´à¸¡
 * ðŸ‘‰ à¸«à¹‰à¸²à¸¡à¹ƒà¸«à¹‰ AI à¸„à¸´à¸”à¹ƒà¸«à¸¡à¹ˆ
 * 
 * à¸«à¸¥à¸±à¸à¸„à¸´à¸”:
 * Refinement = "à¸‚à¸¢à¸²à¸¢à¸„à¸§à¸²à¸¡"
 * à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆ "à¸–à¸²à¸¡à¸•à¹ˆà¸­"
 */
export function isRefinementMessage(message: string): boolean {
  const trimmed = message.trim();
  
  // à¸–à¹‰à¸²à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸¢à¸²à¸§à¹€à¸à¸´à¸™à¹„à¸› â†’ à¹„à¸¡à¹ˆà¸™à¹ˆà¸²à¸ˆà¸°à¹€à¸›à¹‡à¸™ refinement
  if (trimmed.length > 30) {
    return false;
  }

  const refinePatterns = [
    "à¹‚à¸”à¹ˆà¸‡",
    "à¸˜à¸£à¸£à¸¡à¸Šà¸²à¸•à¸´",
    "à¹€à¸à¸²à¸«à¸¥à¸µ",
    "à¹„à¸¡à¹ˆà¹€à¸­à¸²à¹€à¸§à¸­à¸£à¹Œ",
    "à¸›à¸¥à¸²à¸¢à¸žà¸¸à¹ˆà¸‡",
    "à¸žà¸¸à¹ˆà¸‡",
    "à¸ªà¸²à¸¢à¸à¸­",
    "à¹à¸šà¸š",
    "à¸—à¸£à¸‡",
    "à¸ªà¹„à¸•à¸¥à¹Œ",
    "à¹€à¸¥à¹‡à¸",
    "à¹ƒà¸«à¸à¹ˆ",
    "à¹€à¸£à¸µà¸¢à¸§",
    "à¹à¸«à¸¥à¸¡",
    "à¸¡à¸™",
    "à¸«à¸§à¸²à¸™",
    "à¸„à¸¡",
    "à¸›à¸¥à¸²à¸¢",
    "à¸ªà¸²à¸¢"
  ];

  // âŒ à¸«à¹‰à¸²à¸¡à¸¡à¸µà¸„à¸³à¸–à¸²à¸¡ / à¸«à¹‰à¸²à¸¡à¸¡à¸µ intent à¸­à¸·à¹ˆà¸™à¸›à¸™
  const forbiddenPatterns = [
    "à¸£à¸²à¸„à¸²",
    "à¹‚à¸›à¸£",
    "à¹„à¸«à¸¡",
    "?",
    "à¹€à¸—à¹ˆà¸²à¹„à¸«à¸£à¹ˆ",
    "à¸§à¸±à¸™à¹„à¸«à¸™",
    "à¸§à¹ˆà¸²à¸‡",
    "à¸„à¸´à¸§",
    "à¸ˆà¸­à¸‡",
    "à¸™à¸±à¸”",
    "à¸—à¸³à¸­à¸°à¹„à¸£",
    "à¸•à¹ˆà¸²à¸‡à¸à¸±à¸™",
    "à¸¢à¸±à¸‡à¹„à¸‡",
    "à¸­à¸¢à¹ˆà¸²à¸‡à¹„à¸£"
  ];

  const lower = trimmed.toLowerCase();
  
  // à¸–à¹‰à¸²à¸¡à¸µ forbidden pattern â†’ à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆ refinement
  if (forbiddenPatterns.some(pattern => lower.includes(pattern))) {
    return false;
  }

  // à¹€à¸Šà¹‡à¸„à¸§à¹ˆà¸²à¸¡à¸µ refinement pattern à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ
  return refinePatterns.some(pattern => lower.includes(pattern));
}
