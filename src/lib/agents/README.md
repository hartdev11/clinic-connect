# Intelligence Layer ‚Äî Agents

‡πÅ‡∏¢‡∏Å **‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà** ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å **‡πÇ‡∏°‡πÄ‡∏î‡∏•** 100%

## UX Firewall (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç)

- **‡∏´‡πâ‡∏≤‡∏°** ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° error ‡πÄ‡∏ä‡∏¥‡∏á system ‡∏´‡∏•‡∏∏‡∏î‡∏ñ‡∏∂‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô "‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ô" / "error")
- **‡∏ñ‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠ error** ‚Üí ‡πÉ‡∏ä‡πâ `composeSafeFallbackMessage()` ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô  
  ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á: *"‡∏Ç‡∏≠‡πÄ‡∏ä‡πá‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á‡∏ô‡∏∞‡∏Ñ‡∏∞ ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏Ñ‡πà‡∏≤ üòä"*
- ‡∏î‡∏π `safe-fallback.ts` ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡πÉ‡∏ô pipeline + webhook ‡∏ó‡∏∏‡∏Å‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏∂‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤  
‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏• / ‡πÄ‡∏û‡∏¥‡πà‡∏° agent / ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤ ‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ logic ‡∏£‡∏∞‡∏ö‡∏ö

## ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á 3 ‡∏ä‡∏±‡πâ‡∏ô

| ‡∏ä‡∏±‡πâ‡∏ô | ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà | Component |
|-----|--------|-----------|
| **Presentation** | ‡∏£‡∏±‡∏ö/‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏´‡πá‡∏ô | LINE Webhook, Message Normalizer |
| **Intelligence** | ‡∏Ñ‡∏¥‡∏î ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à | Agents A‚ÄìF |
| **Data & Control** | ‡∏á‡∏ö, log, version, flag | (‡∏ï‡πà‡∏≠‡∏°‡∏≤: Agent Router, Budget Guard) |

## Flow

```
User ‚Üí Normalizer ‚Üí Agent A (Intent) ‚Üí Agent B (Safety) ‚Üí Agent E (Escalation)
  ‚Üí Agent C (Knowledge) ‚Üí Agent D (Compose) ‚Üí User
  ‚Üí Agent F (Memory/CRM) [‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á]
```

## Agents

| Agent | ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà | ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ |
|-------|--------|-------------|
| **A** Intent & Context Analyzer | ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏à‡∏ï‡∏ô‡∏≤ + service + confidence | Gemini |
| **B** Policy & Medical Safety Guard | ‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á / refer_to_doctor | Gemini |
| **C** Business Knowledge Engine | ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£ ‡∏£‡∏≤‡∏Ñ‡∏≤ ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç | Logic + DB |
| **D** Conversation Composer | ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‚Üí ‡∏†‡∏≤‡∏©‡∏≤‡∏Ñ‡∏ô (‡∏û‡∏π‡∏î‡∏Å‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤) | ChatGPT |
| **E** Escalation & Human Handoff | ‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠ admin/doctor/support | Gemini |
| **F** Memory / CRM / Analytics | ‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤ tag ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ | Gemini |

- **ChatGPT ‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Agent D** (‡∏û‡∏π‡∏î‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô)
- **Gemini** ‡∏ó‡∏≥ logic / ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• / ‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô (A, B, E, F)
