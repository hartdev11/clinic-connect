/**
 * UX Firewall â€” à¸­à¸¢à¹ˆà¸²à¹ƒà¸«à¹‰à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ error à¹€à¸Šà¸´à¸‡ system à¸«à¸¥à¸¸à¸”à¸–à¸¶à¸‡à¸¥à¸¹à¸à¸„à¹‰à¸²
 * à¸–à¹‰à¸²à¸£à¸°à¸šà¸šà¹„à¸¡à¹ˆà¸¡à¸±à¹ˆà¸™à¹ƒà¸ˆ / error â†’ à¹ƒà¸Šà¹‰à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸™à¸µà¹‰à¹à¸—à¸™
 */
const SAFE_FALLBACK_MESSAGE =
  "à¸‚à¸­à¹€à¸Šà¹‡à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸«à¹‰à¸™à¸´à¸”à¸™à¸¶à¸‡à¸™à¸°à¸„à¸° à¹€à¸”à¸µà¹‹à¸¢à¸§à¹à¸­à¸”à¸¡à¸´à¸™à¸•à¸­à¸šà¸à¸¥à¸±à¸šà¹ƒà¸«à¹‰à¸„à¹ˆà¸² ðŸ˜Š";

/**
 * à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ fallback à¸—à¸µà¹ˆà¸ªà¹ˆà¸‡à¸–à¸¶à¸‡à¸¥à¸¹à¸à¸„à¹‰à¸²à¹€à¸¡à¸·à¹ˆà¸­à¸£à¸°à¸šà¸šà¹„à¸¡à¹ˆà¸¡à¸±à¹ˆà¸™à¹ƒà¸ˆà¸«à¸£à¸·à¸­ error
 * à¸«à¹‰à¸²à¸¡à¹ƒà¸Šà¹‰à¸„à¸³à¸§à¹ˆà¸² à¸£à¸°à¸šà¸š / error / à¸­à¹ˆà¸²à¸™à¹„à¸¡à¹ˆà¸—à¸±à¸™ / à¹„à¸¡à¹ˆà¸•à¸­à¸š à¸¯à¸¥à¸¯
 */
export function composeSafeFallbackMessage(): string {
  return SAFE_FALLBACK_MESSAGE;
}

/**
 * à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸•à¸­à¸šà¸„à¸³à¸–à¸²à¸¡à¹à¸™à¸§ "à¸ˆà¸³à¹„à¸”à¹‰à¹„à¸«à¸¡ / à¸„à¸¸à¸¢à¸­à¸°à¹„à¸£à¸à¸±à¸™" â€” à¹„à¸¡à¹ˆà¹€à¸£à¸µà¸¢à¸ Gemini
 * (à¸à¸£à¸“à¸µà¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹€à¸à¹‡à¸š conversation_history à¸ˆà¸£à¸´à¸‡)
 */
const MEMORY_INQUIRY_MESSAGE =
  "à¸•à¸­à¸™à¸™à¸µà¹‰à¹à¸­à¸”à¸¢à¸±à¸‡à¸ˆà¸³à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸à¸²à¸£à¸„à¸¸à¸¢à¸à¹ˆà¸­à¸™à¸«à¸™à¹‰à¸²à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸„à¸£à¸šà¸—à¸¸à¸à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸™à¸°à¸„à¸° à¸–à¹‰à¸²à¸šà¸­à¸à¹€à¸žà¸´à¹ˆà¸¡à¹„à¸”à¹‰à¸§à¹ˆà¸²à¸­à¸¢à¸²à¸à¹ƒà¸«à¹‰à¸Šà¹ˆà¸§à¸¢à¹€à¸£à¸·à¹ˆà¸­à¸‡à¹„à¸«à¸™ à¹à¸­à¸”à¸Šà¹ˆà¸§à¸¢à¸”à¸¹à¸•à¹ˆà¸­à¹ƒà¸«à¹‰à¹„à¸”à¹‰à¹€à¸¥à¸¢à¸„à¹ˆà¸² ðŸ˜Š";

/**
 * à¹à¸šà¸šà¸—à¸µà¹ˆà¸­à¹‰à¸²à¸‡à¸–à¸¶à¸‡à¸„à¸§à¸²à¸¡à¸ªà¸™à¹ƒà¸ˆà¸„à¸£à¹ˆà¸²à¸§ à¹† (à¹ƒà¸Šà¹‰à¹€à¸¡à¸·à¹ˆà¸­à¸¡à¸µ conversation_history / context à¸ˆà¸£à¸´à¸‡)
 */
const MEMORY_INQUIRY_MESSAGE_SMART =
  "à¹à¸­à¸”à¸žà¸­à¸ˆà¸³à¹„à¸”à¹‰à¸„à¸£à¹ˆà¸²à¸§ à¹† à¸§à¹ˆà¸²à¸„à¸¸à¸“à¸ªà¸™à¹ƒà¸ˆà¹€à¸£à¸·à¹ˆà¸­à¸‡à¸«à¸±à¸•à¸–à¸à¸²à¸£à¸™à¸°à¸„à¸° à¸–à¹‰à¸²à¸­à¸¢à¸²à¸à¸ªà¸­à¸šà¸–à¸²à¸¡à¸•à¹ˆà¸­à¹€à¸£à¸·à¹ˆà¸­à¸‡à¹„à¸«à¸™ à¸šà¸­à¸à¹„à¸”à¹‰à¹€à¸¥à¸¢ à¹€à¸”à¸µà¹‹à¸¢à¸§à¸Šà¹ˆà¸§à¸¢à¹€à¸Šà¹‡à¸à¹ƒà¸«à¹‰à¸„à¹ˆà¸² ðŸ˜Š";

/**
 * à¸•à¸­à¸šà¸„à¸³à¸–à¸²à¸¡à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸„à¸§à¸²à¸¡à¸ˆà¸³à¸‚à¸­à¸‡à¸à¸²à¸£à¸„à¸¸à¸¢ (memory inquiry)
 * à¹ƒà¸Šà¹‰à¹€à¸¡à¸·à¹ˆà¸­à¸”à¸±à¸à¸„à¸³à¸–à¸²à¸¡à¹à¸šà¸š "à¸ˆà¸³à¹„à¸”à¹‰à¹„à¸«à¸¡ / à¸„à¸¸à¸¢à¸­à¸°à¹„à¸£à¸à¸±à¸™" à¸à¹ˆà¸­à¸™à¸–à¸¶à¸‡ Agent A â€” à¹„à¸¡à¹ˆà¹€à¸ªà¸µà¸¢ quota
 * à¸«à¹‰à¸²à¸¡à¸žà¸¹à¸”à¸§à¹ˆà¸² "à¸£à¸°à¸šà¸šà¸ˆà¸³à¹„à¸¡à¹ˆà¹„à¸”à¹‰"
 */
export function composeMemoryAnswer(
  normalized?: { message: string; conversation_history?: unknown[] }
): string {
  // à¸–à¹‰à¸²à¸¡à¸µ conversation_history à¸ˆà¸£à¸´à¸‡ à¸­à¸²à¸ˆà¸•à¸­à¸šà¹à¸šà¸šà¸­à¹‰à¸²à¸‡à¸–à¸¶à¸‡à¸„à¸§à¸²à¸¡à¸ªà¸™à¹ƒà¸ˆà¸„à¸£à¹ˆà¸²à¸§ à¹†
  const hasHistory =
    normalized?.conversation_history &&
    Array.isArray(normalized.conversation_history) &&
    normalized.conversation_history.length > 0;
  return hasHistory ? MEMORY_INQUIRY_MESSAGE_SMART : MEMORY_INQUIRY_MESSAGE;
}
